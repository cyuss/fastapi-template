# Project Template for building Rest API
[![Made With Love](https://img.shields.io/badge/Made%20With-Love-orange.svg)](https://github.com/chetanraj/awesome-github-badges)
![py_version](https://img.shields.io/badge/python-3.6_|_3.7_|_3.8-blue)
![version](https://img.shields.io/badge/version-0.1.0-gree)

A projet template created by [`Cookiecutter`](https://github.com/cookiecutter/cookiecutter) to automate projects creation for REST API development.

<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [Project Template for Rest API](#project-template-for-rest-api)
  - [Project Structure](#project-structure)
  - [Prerequisites](#prerequisites)
    - [Cookiecutter](#cookiecutter)
    - [Poetry](#poetry)
    - [Devmoji](#devmoji)
  - [Get Started](#get-started)
  - [Conventional commits](#conventional-commits)

<!-- /TOC -->

## Project Structure
First of all, we illustrate the project structure by describing each file and directory created in this template.

```
.
‚îú‚îÄ‚îÄ .dockerignore
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .isort.cfg                       # isort config file (sort imports)
‚îú‚îÄ‚îÄ CHANGELOG.md                     # autogenerated file by devmoji
‚îú‚îÄ‚îÄ data
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docs                             # documentation and examples
‚îú‚îÄ‚îÄ Makefile                         # predefined command lines
‚îú‚îÄ‚îÄ models                           # serialized ML/DL models
‚îú‚îÄ‚îÄ notebooks                        # all notebooks for data exploration
‚îú‚îÄ‚îÄ pytest.ini                       # pytest config file
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ tests                            # unit and ML tests
‚îÇ  ‚îú‚îÄ‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ‚îÄ conftest.py                   # conftest file for pytest
‚îÇ  ‚îú‚îÄ‚îÄ test_api                      # api unit tests
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ test_webservice.py
‚îÇ  ‚îî‚îÄ‚îÄ test_ml                       # ML tests
‚îÇ     ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ TODO.org                         # todo list in org mode file
‚îú‚îÄ‚îÄ tox.ini                          # tox config file
‚îî‚îÄ‚îÄ {{ cookiecutter.project_slug }}  # project subdirectory (main dir)
   ‚îú‚îÄ‚îÄ __init__.py
   ‚îú‚îÄ‚îÄ core                          # api config directory
   ‚îÇ  ‚îú‚îÄ‚îÄ __init__.py
   ‚îÇ  ‚îú‚îÄ‚îÄ event_handlers.py          # event handlers config (e.g: api start)
   ‚îÇ  ‚îú‚îÄ‚îÄ middlewares.py             # middlewares config (e.g: request_id)
   ‚îÇ  ‚îú‚îÄ‚îÄ settings.py                # api settings, global variables... etc
   ‚îÇ  ‚îî‚îÄ‚îÄ setup_logger.py            # logger configuration (e.g: log format)
   ‚îú‚îÄ‚îÄ db                            # database communication functions
   ‚îÇ  ‚îî‚îÄ‚îÄ __init__.py
   ‚îú‚îÄ‚îÄ main.py                       # main file to start the API
   ‚îú‚îÄ‚îÄ routes                        # routes dir
   ‚îÇ  ‚îú‚îÄ‚îÄ __init__.py                # global routes store
   ‚îÇ  ‚îú‚îÄ‚îÄ hello_route.py             # default route created
   ‚îÇ  ‚îî‚îÄ‚îÄ schemas.py                 # schemas for input/output validation
   ‚îî‚îÄ‚îÄ utils                         # utility functions
      ‚îî‚îÄ‚îÄ __init__.py
```

## Prerequisites
To generate a new project from this template, first you should install the following packages:

### Cookiecutter
[`Cookiecutter`](https://github.com/cookiecutter/cookiecutter) is a command-line utility that creates projects from templates. You can install it using `pip`:

```shell
pip install cookiecutter
```
Or, using Homebrew (Mac OS X only):
```shell
brew install cookiecutter
```

### Poetry
To make dependencies installation easier, we use [`Poetry`](https://github.com/python-poetry/poetry) as a dependency manager. You can install it using `pip`:

```shell
pip install poetry
```

Or, using Homebrew (Mac OS X only):
```shell
brew install poetry
```

### Devmoji
> [Devmoji](https://github.com/folke/devmoji) is a command line tool that adds color üåà to conventional commits, using emojis inspired by Gitmoji üòú.
> Some of the things Devmoji can do:
>   - **emojify:** convert input between diferent emoji formats unicode, shortcode and devmoji. devmoji are easy to remember aliases like: :test:, :refactor:, :docs:, :security instead of hard to remember emoji codes
>   - **git commit:** install a prepare-commit-msg commit hook to ‚ú® automagically emojify and lints your commit message
>   - **git log:** emojify and colorify the output of git log even for projects not using emojis

You can install `devmoji` using `npm` or `yarn`:
```shell
npm install -g devmoji
yarn global add devmoji
```

## Get Started
To initiate a new project using this template, you can simply use:
```shell
cookiecutter https://github.com/cyuss/fastapi-template.git
```

Then you need to setup python environment and install some dependencies. For that, you can use the predefined commands in `Makefile`.

```
AVAILABLE COMMANDS
 bake                           Init a poetry env and installing some useful packages (run this first).
                                Install poetry with `pip install poetry`.
 build_docker                   Build a Docker container based on Dockerfile.
 check_format                   Check what to change using black.
 clean                          Delete unwanted files.
 clean_docker                   Stop and delete the container.
 cloc                           Count blank lines, comment lines, and physical lines of source code.
 code_metrics                   Compute various metrics from the source code (code quality).
 coverage                       Run coverage tests.
 dcup                           Build Docker compose.
 devmoji                        Init devmoji (add emojis to commit messages).
                                Install it with `npm install -g devmoji`.
 format                         Format the source code using black.
 isort                          Sort the imports using isort.
 reqs                           Generate a requirements.txt file.
 reqs_dev                       Generate a requirements_dev.txt file.
 run_docker                     Run the built Docker container.
 start                          Start the API locally.
 test                           Run unit tests.
 tox                            Run tox.
 update_deps                    Update dependencies.
```

First command to execute is:
```zsh
make bake
```

It inits a `poetry` environment and install following dependencies used for this workflow:
- fastapi, uvicorn, requests (web framework tools for building API with Python),
- loguru (logging library),
- pytest, pytest-cov, tox (for unit/ml tests)

Once everything is installed, you can now start building your API.
To get fancy and organized commit messages, you should setup `devmoji` with:
```zsh
make devmoji
```

It configs `devmoji` as a `prepare-commit` hook in `git` without using a third-party package. `devmoji` automatically add emojis corresponding to commit type (cf. [Conventional commits](#conventional-commits))

**P.S:** this step is optional, you can ignore it if you wanna keep traditional commit messages.

## Conventional commits
To keep the commit history explicit, clean and organized, it's interesting to follow a set of rules that define a lightweight convention on top of commit messages. Inspired by [conventional commits](https://www.conventionalcommits.org/en/v1.0.0/), a commit message should be structured as follows:

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

The `<type>` describes the commit type and takes the following values:

```
- ‚ú®   :feat:          feat: a new feature
- üêõ   :fix:           fix: a bug fix
- üìöÔ∏è   :docs:          docs: documentation only changes
- üé®   :style:         style: changes that do not affect the meaning of the code
                       (white-space, formatting, missing semi-colons, etc)
- ‚ôªÔ∏è    :refactor:      refactor: a code change that neither fixes a bug nor adds a feature
- ‚ö°Ô∏è    :perf:          perf: a code change that improves performance
- üö®   :test:          test: adding missing or correcting existing tests
- üîß   :chore:         chore: changes to the build process or auxiliary tools and
                       libraries such as documentation generation
- üöÄ   :chore-release: chore(release): code deployment or publishing to external repositories
- üîó   :chore-deps:    chore(deps): add or delete dependencies
- üì¶Ô∏è   :build:         build: changes related to build processes
- üë∑   :ci:            ci: updates to the continuous integration system
- ‚öôÔ∏è    :config:        config: Changing configuration files.
- üîíÔ∏è   :security:      security: Fixing security issues.
```

**P.S:** If `devmoji` is configued (using the `makefile` command), it adds an emojy to every commit message according to its type.
